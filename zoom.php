<?php

// Generate a list of nodes at a given zoom level

error_reporting(E_ALL);

ini_set('memory_limit', '-1');


require_once('tree/node.php');
require_once('tree/tree.php');
require_once('tree/node_iterator.php');
require_once('tree/tree-parse.php');


require_once('tree/fake_priority_queue.php');
require_once('tree/utils.php');

require_once('tree/tree-order.php');

$newick = "('KJ836409.1':0.03942,(((('KJ837499.1':0.00079,('HQ948094.1':0.00584,(('KJ836642.1':0.00224,('KJ836862.1':0.00000,'KJ836538.1':0.00238)'Heriades crenulatus':0.00014)'Heriades crenulatus':0.00070,((('KJ838652.1':0.00000,'KJ839820.1':0.00007)'Heriades crenulatus':0.00007,'KJ836425.1':0.00000)'Heriades crenulatus':0.00007,'HQ948093.1':0.00000)'Heriades crenulatus':0.00170)'Heriades crenulatus':0.00135)'Heriades crenulatus':0.00039)'Heriades crenulatus':0.02093,((((('KT074045.1':0.00000,'KJ836515.1':0.00000)'Heriades truncorum':0.00000,'KJ838226.1':0.00000)'Heriades truncorum':0.00000,'HM901923.1':0.00000)'Heriades truncorum':0.00059,'KJ836448.1':0.00179)'Heriades truncorum':0.00097,'KJ839494.1':0.00141)'Heriades truncorum':0.03474)Heriades:0.03262,('KR786504.1':0.00510,(('FJ582232.1':0.00000,('KJ163559.1':0.00236,'FJ582230.1':0.00482)'Heriades carinatus':0.00009)'Heriades carinatus':0.00067,'FJ582231.1':0.00172)'Heriades carinatus':0.00451)'Heriades carinatus':0.05182)Heriades:0.01194,(((((((('KX957905.1':0.00000,'GU705980.1':0.00478)'Osmia bicornis':0.00001,'KJ837790.1':0.00000)'Osmia bicornis':0.00001,'KJ837713.1':0.00000)'Osmia bicornis':0.00069,((((((((((((((('KX957869.1':0.00000,'KX374766.1':0.00000)'Osmia bicornis':0.00000,'KX957868.1':0.00000)'Osmia bicornis':0.00000,'KX957867.1':0.00000)'Osmia bicornis':0.00000,'KX957865.1':0.00000)'Osmia bicornis':0.00000,'KX957864.1':0.00000)'Osmia bicornis':0.00000,'KX957863.1':0.00000)'Osmia bicornis':0.00000,'KX957862.1':0.00000)'Osmia bicornis':0.00000,'KX957861.1':0.00000)'Osmia bicornis':0.00000,'KX957860.1':0.00000)'Osmia bicornis':0.00000,'KX374767.1':0.00000)'Osmia bicornis':0.00000,'GU705983.1':0.00000)'Osmia bicornis':0.00060,('KX957904.1':0.00178,(('KX374770.1':0.00000,'KX957903.1':0.00001)'Osmia bicornis':0.00001,'GU705978.1':0.00000)'Osmia bicornis':0.00060)'Osmia bicornis':0.00178)'Osmia bicornis':0.00061,'KY121842.1':0.00118)Apoidea:0.00116,('KX957866.1':0.00000,((((('JQ909849.1':0.00238,'GU705979.1':0.00000)'Osmia bicornis':0.00000,'KT164634.1':0.00000)'Osmia bicornis':0.00000,'KT074073.1':0.00000)'Osmia bicornis':0.00000,'KY121818.1':0.00000)Apoidea:0.00000,'KY121823.1':0.00000)Apoidea:0.00000)Apoidea:0.00003)Apoidea:0.00019,'KC709831.1':0.00000)Apoidea:0.00172)Apoidea:0.01101,'AF250940.1':0.00780)Apoidea:0.00451,('AF250941.1':0.01160,((((('EU726628.1':0.00000,'EU726627.1':0.00000)'Osmia cornifrons':0.00000,'EU726626.1':0.00000)'Osmia cornifrons':0.00000,'EU726621.1':0.00000)'Osmia cornifrons':0.00000,'EU726549.1':0.00000)'Osmia cornifrons':0.00125,('EU726624.1':0.00000,'EU726601.1':0.00000)'Osmia cornifrons':0.00114)'Osmia cornifrons':0.02131)Osmia:0.00363)Apoidea:0.05114,((('KJ838228.1':0.00239,'HM901915.1':0.00239)'Hoplitis claviventris':0.00038,'KJ837591.1':0.00201)'Hoplitis claviventris':0.03980,(('KM568799.1':0.00000,'KM562022.1':0.00000)'Hoplitis sp. bc4':0.03680,'HQ948088.1':0.03826)Hoplitis:0.01356)Hoplitis:0.02205)Apoidea:0.01340,('KC560283.1':0.00647,('KY072536.1':0.00206,(((((((((((((((((('KY072692.1':0.00000,'KY072384.1':0.00238)'unclassified Apoidea':0.00000,'KY072512.1':0.00000)'unclassified Apoidea':0.00000,'KY072457.1':0.00000)'unclassified Apoidea':0.00000,'KY072408.1':0.00000)'unclassified Apoidea':0.00000,'KY072378.1':0.00000)'unclassified Apoidea':0.00000,'KY072344.1':0.00000)'unclassified Apoidea':0.00000,'KY072316.1':0.00000)'unclassified Apoidea':0.00000,'KY072314.1':0.00000)'unclassified Apoidea':0.00000,'KY072271.1':0.00000)'unclassified Apoidea':0.00000,'KY072263.1':0.00000)'unclassified Apoidea':0.00000,'KY072262.1':0.00000)'unclassified Apoidea':0.00000,'KY072261.1':0.00000)'unclassified Apoidea':0.00000,'KY072174.1':0.00000)'unclassified Apoidea':0.00000,'KY072146.1':0.00000)'unclassified Apoidea':0.00000,'KP259020.1':0.00000)Apoidea:0.00000,'KP259004.1':0.00000)Apoidea:0.00234,(('KY072458.1':0.00000,(('KY072490.1':0.00000,'KY072495.1':0.00000)'unclassified Apoidea':0.00000,('KY072601.1':0.00000,'KY072662.1':0.00000)'unclassified Apoidea':0.00000)'unclassified Apoidea':0.00000)'unclassified Apoidea':0.00000,(('KY072382.1':0.00000,'KP259033.1':0.00000)Apoidea:0.00000,'KY072383.1':0.00000)Apoidea:0.00000)Apoidea:0.00004)Apoidea:0.00019,('KY072600.1':0.00237,(('KY072422.1':0.00000,('KY072388.1':0.00000,'KY072389.1':0.00000)'unclassified Apoidea':0.00000)Apoidea:0.00000,(('KY072370.1':0.00000,'KY072377.1':0.00000)'unclassified Apoidea':0.00000,('KP259058.1':0.00000,'KY072268.1':0.00000)Apoidea:0.00000)Apoidea:0.00000)Apoidea:0.00000)Apoidea:0.00001)Apoidea:0.00220)Apoidea:0.00032)Apoidea:0.00071)Apoidea:0.02660)Apoidea:0.00696)Apoidea:0.03942;";

// BLAST query = MW496845
$newick='((JQ534364.1:0.000664498,HM377932.1:0.00238119):0.0158508,((GU336118.1:0.0299451,((((MF923603.1:0.00144871,JQ560149.1:7.25928e-05):0.00103588,(MF922836.1:0.00105745,(((GU658490.1:0,JQ554463.1:0):3.63216e-05,MF924198.1:0.00148498):0.000238447,MF924177.1:0.0012844):0.000465396):0.000489872):0.00762471,((HQ556542.1:0,JQ551610.1:0.0015284):0.00019077,(JQ565745.1:0.00282908,HM408169.1:0.000216611):0.00133673):0.00819708):0.0130086,AF277443.1:0.0278096):0.00213639):0.00630278,((JN266473.1:0.000332212,(HQ553212.1:0.00119493,MK767790.1:0.000326372):0.00119063):0.0302603,((JN262846.1:0.0191797,(((((JQ556316.1:0.00148774,(HM408299.1:0.00151358,HM409842.1:7.71581e-06):3.51094e-05):4.07505e-05,JQ558137.1:0.00148209):0.000639751,(JQ545067.1:0,JQ548064.1:1.32211e-05):0.00241355):0.00710851,(((HM408168.1:6.13358e-05,(JQ556315.1:0,JQ548044.1:5.82833e-06):0.00146112):0.000281758,(((((JQ551063.1:0.00305049,(JQ547907.1:0,(JQ552569.1:0,JQ552568.1:0.00152472):0.0015266):4.33725e-07):1.31139e-06,HM408460.1:0.00152134):2.9275e-06,HM408461.1:0):1.58982e-05,JQ552570.1:0.00303376):0.000334128,JQ562164.1:0.00424939):0.00124682):0.00464347,((KX300289.1:0,JX571578.1:0):0.00152252,JF854867.1:0):0.00457624):0.00950048):0.00406438,((((((JQ578644.1:0.00274102,(JQ571546.1:0.00278948,((JQ569548.1:0.00306,GU700040.1:0):0.000102627,JQ578086.1:0.00142294):0.000261448):0.000310879):0.00051296,JQ573881.1:0.0056083):0.00560477,(HM403389.1:0,(JQ548012.1:0,JQ564645.1:9.36314e-06):2.63113e-05):0.00712252):0.00564858,(JQ568903.1:0.00164051,((JN266340.1:0,(JQ547905.1:0,JF844512.1:0.00152698):7.70211e-06):0.000124126,JQ569694.1:0.00292893):0.00141605):0.0146022):0.000947217,(((HQ568274.1:0,(KF533459.1:0,JN266461.1:0.00152526):9.53151e-06):0.00242324,HQ567922.1:0.003686):0.00161778,KX300252.1:0.00451872):0.00579766):0.00158158,((JX571167.1:0,JX571169.1:0.0015408):0.000666605,JX571168.1:0.00391124):0.0244588):0.00196066):0.000455247):0.00102225,((((((JQ556321.1:0.00117271,((((GU147164.1:0,(JQ574230.1:0,GU335433.1:1.36745e-06):5.55217e-06):3.97566e-06,JQ551045.1:0.00152198):2.46985e-06,GU160538.1:0):2.96526e-05,JQ551046.1:0.00301992):0.000350714):0.000623485,((GU335427.1:0,HQ556675.1:0.0015271):0.000280422,JQ559031.1:0.00124242):0.000903601):0.00129078,GU160540.1:0.00482864):0.00189019,HQ571061.1:0.00577895):0.00679539,(KX300291.1:0,JN262740.1:0):0.0135512):0.00946709,(MN621041.1:0.0257085,(((((JQ557343.1:0.00121528,(GU699730.1:0.00149222,GU147586.1:2.9081e-05):0.000307566):0.00118575,(GU147583.1:0,JQ560034.1:0.00152346):0.0003398):0.00113981,HM403740.1:0.000383613):0.0244556,MK767638.1:0.0271593):0.00614908,(((OM594190.1:0.0105504,((GU335861.1:0.000189918,GU335864.1:0):0.0166235,MN621036.1:0.0169641):0.00535654):0.0014135,(MN621026.1:0.0107948,(JN266442.1:0,JN266444.1:0.00155798):0.0108116):0.00732199):0.00866236,(((((JQ555038.1:0.00153756,JQ547796.1:0.00150813):0.000326153,(JQ547664.1:0.00227641,((JQ546935.1:0,JQ567146.1:3.98983e-05):0.00079921,HM409276.1:0.000736233):0.000786605):0.00196743):0.00126957,JQ566102.1:0.0036319):0.00142321,HM408897.1:0.00397348):0.011195,(MK767210.1:0.00779523,(MW496845.1:0,MW496845.1:0):0.00291923):0.0165676):0.0104006):0.00245598):0.00266401):0.00165969):0.00186284):0.00152768):0.000738379):0.0158508);';
$newick="(('JQ534364.1':0.00066,'HM377932.1':0.00238)Lepidoptera:0.01585,(('GU336118.1':0.02995,(((('MF923603.1':0.00145,'JQ560149.1':0.00007)'Cosmosoma festivum':0.00104,('MF922836.1':0.00106,((('GU658490.1':0.00000,'JQ554463.1':0.00000)'Cosmosoma festivum':0.00004,'MF924198.1':0.00148)'Cosmosoma festivum':0.00024,'MF924177.1':0.00128)'Cosmosoma festivum':0.00047)'Cosmosoma festivum':0.00049)'Cosmosoma festivum':0.00762,(('HQ556542.1':0.00000,'JQ551610.1':0.00153)Lepidoptera:0.00019,('JQ565745.1':0.00283,'HM408169.1':0.00022)Lepidoptera:0.00134)Lepidoptera:0.00820)Lepidoptera:0.01301,'AF277443.1':0.02781)Lepidoptera:0.00214)Lepidoptera:0.00630,(('JN266473.1':0.00033,('HQ553212.1':0.00119,'MK767790.1':0.00033)'Cosmosoma metallescens':0.00119)Cosmosoma:0.03026,(('JN262846.1':0.01918,((((('JQ556316.1':0.00149,('HM408299.1':0.00151,'HM409842.1':0.00001)'Lepidoptera sp. BOLD:AAA1399':0.00004)Lepidoptera:0.00004,'JQ558137.1':0.00148)Lepidoptera:0.00064,('JQ545067.1':0.00000,'JQ548064.1':0.00001)'Saurita tipulina':0.00241)Lepidoptera:0.00711,((('HM408168.1':0.00006,('JQ556315.1':0.00000,'JQ548044.1':0.00001)'Saurita afflicta':0.00146)Lepidoptera:0.00028,((((('JQ551063.1':0.00305,('JQ547907.1':0.00000,('JQ552569.1':0.00000,'JQ552568.1':0.00152)'Saurita afflicta':0.00153)'Saurita afflicta':0.00000)'Saurita afflicta':0.00000,'HM408460.1':0.00152)Lepidoptera:0.00000,'HM408461.1':0.00000)Lepidoptera:0.00002,'JQ552570.1':0.00303)Lepidoptera:0.00033,'JQ562164.1':0.00425)Lepidoptera:0.00125)Lepidoptera:0.00464,(('KX300289.1':0.00000,'JX571578.1':0.00000)'Mesothen desperata':0.00152,'JF854867.1':0.00000)'Mesothen desperata':0.00458)Lepidoptera:0.00950)Lepidoptera:0.00406,(((((('JQ578644.1':0.00274,('JQ571546.1':0.00279,(('JQ569548.1':0.00306,'GU700040.1':0.00000)Lepidoptera:0.00010,'JQ578086.1':0.00142)Lepidoptera:0.00026)Lepidoptera:0.00031)Lepidoptera:0.00051,'JQ573881.1':0.00561)Lepidoptera:0.00560,('HM403389.1':0.00000,('JQ548012.1':0.00000,'JQ564645.1':0.00001)'Dycladia sp. emeritaDHJ03':0.00003)Lepidoptera:0.00712)Lepidoptera:0.00565,('JQ568903.1':0.00164,(('JN266340.1':0.00000,('JQ547905.1':0.00000,'JF844512.1':0.00153)Lepidoptera:0.00001)Lepidoptera:0.00012,'JQ569694.1':0.00293)Lepidoptera:0.00142)Lepidoptera:0.01460)Lepidoptera:0.00095,((('HQ568274.1':0.00000,('KF533459.1':0.00000,'JN266461.1':0.00153)'Dycladia lucetia':0.00001)'Dycladia lucetia':0.00242,'HQ567922.1':0.00369)'Dycladia lucetia':0.00162,'KX300252.1':0.00452)'Dycladia lucetia':0.00580)Lepidoptera:0.00158,(('JX571167.1':0.00000,'JX571169.1':0.00154)'Arctiinae sp. JAT15':0.00067,'JX571168.1':0.00391)'Arctiinae sp. JAT15':0.02446)Lepidoptera:0.00196)Lepidoptera:0.00046)Lepidoptera:0.00102,(((((('JQ556321.1':0.00117,(((('GU147164.1':0.00000,('JQ574230.1':0.00000,'GU335433.1':0.00000)'Cosmosoma sp. stibostictumDHJ01':0.00001)'Cosmosoma sp. stibostictumDHJ01':0.00000,'JQ551045.1':0.00152)'Cosmosoma sp. stibostictumDHJ01':0.00000,'GU160538.1':0.00000)'Cosmosoma sp. stibostictumDHJ01':0.00003,'JQ551046.1':0.00302)'Cosmosoma sp. stibostictumDHJ01':0.00035)'Cosmosoma sp. stibostictumDHJ01':0.00062,(('GU335427.1':0.00000,'HQ556675.1':0.00153)Lepidoptera:0.00028,'JQ559031.1':0.00124)Lepidoptera:0.00090)Lepidoptera:0.00129,'GU160540.1':0.00483)Lepidoptera:0.00189,'HQ571061.1':0.00578)Lepidoptera:0.00680,('KX300291.1':0.00000,'JN262740.1':0.00000)'Cosmosoma harpalyce':0.01355)Lepidoptera:0.00947,('MN621041.1':0.02571,((((('JQ557343.1':0.00122,('GU699730.1':0.00149,'GU147586.1':0.00003)Lepidoptera:0.00031)Lepidoptera:0.00119,('GU147583.1':0.00000,'JQ560034.1':0.00152)'Loxophlebia flavipicta':0.00034)Lepidoptera:0.00114,'HM403740.1':0.00038)Lepidoptera:0.02446,'MK767638.1':0.02716)Lepidoptera:0.00615,((('OM594190.1':0.01055,(('GU335861.1':0.00019,'GU335864.1':0.00000)'Loxophlebia sp. Janzen01':0.01662,'MN621036.1':0.01696)Loxophlebia:0.00536)Loxophlebia:0.00141,('MN621026.1':0.01079,('JN266442.1':0.00000,'JN266444.1':0.00156)'Mesothen desperata':0.01081)Arctiinae:0.00732)Arctiinae:0.00866,((((('JQ555038.1':0.00154,'JQ547796.1':0.00151)Arctiinae:0.00033,('JQ547664.1':0.00228,(('JQ546935.1':0.00000,'JQ567146.1':0.00004)'Loxophlebia imitata':0.00080,'HM409276.1':0.00074)Lepidoptera:0.00079)Lepidoptera:0.00197)Lepidoptera:0.00127,'JQ566102.1':0.00363)Lepidoptera:0.00142,'HM408897.1':0.00397)Lepidoptera:0.01120,('MK767210.1':0.00780,('MW496845.1':0.00000,'MW496845.1':0.00000):0.00292):0.01657):0.01040):0.00246):0.00266):0.00166):0.00186):0.00153):0.00074):0.01585);";

//require_once('butterflies.php');
//require_once('AALF015423.php');
//require_once('phylo.io.php');
require_once('examples/figwasp.php');

//require_once('Culex.php');


//$newick = file_get_contents('odonto_decoded.tre');

$newick="(Staphylus_chlorocephala:0.0237732,((((((Hesperopsis_alpheus:0.000639391,Hesperopsis_alpheus:0.000884226):0.00308805,(((Hesperopsis_gracielae:0,Hesperopsis_gracielae:4.14235e-06):0.00113185,((Hesperopsis_gracielae:0,(Hesperopsis_gracielae:0,Hesperopsis_gracielae:0.00152654):4.96578e-06):4.96578e-06,Hesperopsis_alpheus:0):0.000391288):0.000425861,((Hesperopsis_gracielae:0.000515801,Hesperopsis_gracielae:0.00100782):0.000923844,Hesperopsis_gracielae:0.000601324):0.000338371):0.00709352):0.0114105,((Hesperopsis_libya:0.00143,(Hesperopsis_libya:0,Hesperopsis_libya:0.00154496):9.51686e-05):0.00147503,Hesperopsis_libya:0.00311137):0.0329149):0.010115,(((Muschampia_lavatherae:0.0014139,((Muschampia_lavatherae:0,Muschampia_lavatherae:1.69411e-05):1.69411e-05,Muschampia_lavatherae:0):0.000109141):0.000487225,Muschampia_lavatherae:0.00103562):0.00647381,((((Muschampia_lavatherae:0.00151711,((((Muschampia_lavatherae:0,Muschampia_lavatherae:0):0,Muschampia_lavatherae:0):0,Muschampia_lavatherae:0):0.00152069,(Muschampia_lavatherae:0.00152069,Muschampia_lavatherae:9.92705e-06):2.15901e-06):5.73105e-06):1.1395e-05,Muschampia_lavatherae:0):1.37187e-05,Muschampia_lavatherae:0):1.37187e-05,Muschampia_lavatherae:0):0.00735905):0.0428279):0.00256505,((((Staphylus_floridus:0.00479477,Staphylus_hayhurstii:0.00593613):0.00950263,(((Staphylus_ascalaphus:6.94104e-05,((Staphylus_ascalaphus:0,Staphylus_ascalaphus:0):7.80598e-05,'Lepidopterasp.BOLD:AAB4636':0.00297227):0.00145731):0.00126891,Staphylus_ascalaphus:0.00025782):0.00135436,Staphylus_mazans:0.00170222):0.021793):0.017035,(((((Staphylus_azteca:0.0048385,((((Staphylus_azteca:0.000155294,(Staphylus_azteca:0.000925573,Staphylus_azteca:0.00212012):0.000605355):0.00029665,Staphylus_azteca:0.00581649):0.000539017,(((Staphylus_azteca:0,(Staphylus_azteca:0.000375426,(Staphylus_azteca:0.00190361,(Staphylus_azteca:0,Staphylus_azteca:0.00152484):0.00114518):0.000384447):0.00115245):1.23462e-05,Staphylus_azteca:0):0.000177805,Staphylus_azteca:0.00134584):0.000422943):0.000739331,(Staphylus_azteca:0.000772086,Staphylus_azteca:0.000749213):0.000212706):0.00229232):0.0286512,(((Staphylus_caribbea:0.000807814,(((Staphylus_caribbea:0.00149666,(Staphylus_caribbea:0,Staphylus_caribbea:2.30837e-06):2.58021e-05):0.000657654,(Staphylus_caribbea:0.00150199,(Staphylus_caribbea:0,Staphylus_caribbea:0.00152446):2.0857e-05):0.000868337):0.000141939,'Lepidopterasp.BOLD:AAB1786':0.00061791):0.000716146):0.000367916,Staphylus_caribbea:0.000583016):0.000729467,(Staphylus_caribbea:0.00411255,Staphylus_caribbea:0.000460636):0.00461221):0.0289247):0.00220124,((Staphylus_musculus:0.0218633,(Staphylus_vulgata:0.00042134,Staphylus_vulgata:0.00109996):0.0300987):0.00627445,(Staphylus_melangon:0,(Staphylus_melangon:0.00151861,Staphylus_melangon:0.00152708):7.1837e-05):0.0380202):0.00204968):0.00036291,Staphylus_ascalon:0.0224798):0.000873614,((((((((Staphylus_oeta:0,(Staphylus_oeta:0.000755917,Staphylus_oeta:0.00393893):0.000766374):5.72473e-06,Staphylus_oeta:0):5.72473e-06,Staphylus_oeta:0):5.72473e-06,Staphylus_oeta:0):5.72473e-06,Staphylus_oeta:0):5.72473e-06,Staphylus_oeta:0):0.00067373,(Staphylus_oeta:0,Staphylus_oeta:0):0.00237279):0.0193498,(Staphylus_vulgata:0.000989222,(Staphylus_vulgata:0.000772344,((Staphylus_vulgata:0.00123535,(Staphylus_vulgata:0,Staphylus_vulgata:3.82946e-06):0.000287111):0.00134764,((Staphylus_vulgata:0,(Staphylus_vulgata:0,Staphylus_vulgata:0.00305233):5.29557e-06):0.000132615,(Staphylus_vulgata:0,Staphylus_vulgata:4.15268e-06):0.00139226):0.000178865):0.000368856):0.00072456):0.0221729):0.0070417):0.00529456):0.00517641,Bolla_imbras:0.0434287):0.00166742):0.000872441,((Staphylus_ecos:0.0162318,(((Staphylus_ceos:0,Staphylus_ceos:0):0,Staphylus_ceos:0):0.00221818,Staphylus_ceos:0.00541936):0.0117738):0.0183841,(Staphylus_sp._Janzen10:0.00679433,(Staphylus_vincula:0.00115124,(Staphylus_vincula:0,Staphylus_vincula:0):0.00189445):0.00703648):0.0173017):0.00400419):0.0237732);";
$newick="(MF546168.1:0.0237732,((((((KP895747.1:0.000639391,KP895745.1:0.000884226):0.00308805,(((HQ543507.1:0,KP895750.1:4.14235e-06):0.00113185,((HQ543505.1:0,(KP895748.1:0,KP895757.1:0.00152654):4.96578e-06):4.96578e-06,JF861941.1:0):0.000391288):0.000425861,((KP895752.1:0.000515801,KP895755.1:0.00100782):0.000923844,KP895749.1:0.000601324):0.000338371):0.00709352):0.0114105,((KP895737.1:0.00143,(KP895738.1:0,KP895740.1:0.00154496):9.51686e-05):0.00147503,KP895739.1:0.00311137):0.0329149):0.010115,(((KP870251.1:0.0014139,((OK345694.1:0,KP870647.1:1.69411e-05):1.69411e-05,GU676160.1:0):0.000109141):0.000487225,OK345735.1:0.00103562):0.00647381,((((MW501583.1:0.00151711,((((MW503439.1:0,MW503023.1:0):0,MW499484.1:0):0,HQ004177.1:0):0.00152069,(MN145117.1:0.00152069,MK186200.1:9.92705e-06):2.15901e-06):5.73105e-06):1.1395e-05,OK345676.1:0):1.37187e-05,MW503421.1:0):1.37187e-05,MN143287.1:0):0.00735905):0.0428279):0.00256505,((((ON351018.1:0.00479477,HM428328.1:0.00593613):0.00950263,(((GU151661.1:6.94104e-05,((JF753157.1:0,GU150865.1:0):7.80598e-05,HM885448.1:0.00297227):0.00145731):0.00126891,ON351019.1:0.00025782):0.00135436,HQ581193.1:0.00170222):0.021793):0.017035,(((((GU155502.1:0.0048385,((((GU151676.1:0.000155294,(GU155500.1:0.000925573,JF778480.1:0.00212012):0.000605355):0.00029665,GU150881.1:0.00581649):0.000539017,(((GU151665.1:0,(GU151668.1:0.000375426,(GU151674.1:0.00190361,(GU155501.1:0,GU151673.1:0.00152484):0.00114518):0.000384447):0.00115245):1.23462e-05,JF761179.1:0):0.000177805,GU151672.1:0.00134584):0.000422943):0.000739331,(GU155505.1:0.000772086,GU151669.1:0.000749213):0.000212706):0.00229232):0.0286512,(((GU151663.1:0.000807814,(((HM885447.1:0.00149666,(GU161858.1:0,JF753161.1:2.30837e-06):2.58021e-05):0.000657654,(HM885911.1:0.00150199,(HM885909.1:0,HM885908.1:0.00152446):2.0857e-05):0.000868337):0.000141939,JF858328.1:0.00061791):0.000716146):0.000367916,JF762935.1:0.000583016):0.000729467,(JF762937.1:0.00411255,JF762936.1:0.000460636):0.00461221):0.0289247):0.00220124,((MF546431.1:0.0218633,(MF545712.1:0.00042134,MF546957.1:0.00109996):0.0300987):0.00627445,(MF545480.1:0,(MF545508.1:0.00151861,MF546357.1:0.00152708):7.1837e-05):0.0380202):0.00204968):0.00036291,OP231467.1:0.0224798):0.000873614,((((((((MZ336002.1:0,(MZ335598.1:0.000755917,MZ334988.1:0.00393893):0.000766374):5.72473e-06,MZ335920.1:0):5.72473e-06,MZ335764.1:0):5.72473e-06,MZ335526.1:0):5.72473e-06,MZ335467.1:0):5.72473e-06,MZ335101.1:0):0.00067373,(MZ336013.1:0,MZ335785.1:0):0.00237279):0.0193498,(GU151692.1:0.000989222,(GU151694.1:0.000772344,((JF761184.1:0.00123535,(GU151687.1:0,JF753171.1:3.82946e-06):0.000287111):0.00134764,((GU151697.1:0,(JF753170.1:0,GU151701.1:0.00305233):5.29557e-06):0.000132615,(GU151706.1:0,JF753169.1:4.15268e-06):0.00139226):0.000178865):0.000368856):0.00072456):0.0221729):0.0070417):0.00529456):0.00517641,MW807749.1:0.0434287):0.00166742):0.000872441,((ON351020.1:0.0162318,(((KY019902.1:0,HM421563.1:0):0,HQ583467.1:0):0.00221818,JF861935.1:0.00541936):0.0117738):0.0183841,(GU150888.1:0.00679433,(ON351021.1:0.00115124,(ON351022.1:0,ON351022.1:0):0.00189445):0.00703648):0.0173017):0.00400419):0.0237732);";

$newick = file_get_contents('problem trees/phylo.io.1.nwk-fixed');

$newick = file_get_contents('legume.tre');

//$newick = "(('GBMNE30218-21':0.00068,((('THSIM030-09':0.00003,'GBMNA46365-19':0.00004)Diptera:0.00012,('GBMNA46419-19':0.00011,('GBMNE30222-21':0.00006,'GBMIN60929-17':0.00008)Simulium:0.00004)Simulium:0.00008)Diptera:0.00043,(('GBMNE30232-21':0.00000,'GBMNE30231-21':0.00000)Simulium:0.00035,(('GBMNA46394-19':0.00026,(('GBMNC2086-20':0.00000,'GBMNC2085-20':0.00000)'Simulium maehongsonense':0.00001,'GBMNC2084-20':0.00002)'Simulium maehongsonense':0.00018)Simulium:0.00015,((('GBSIM419-14':0.00015,'GBSIM421-14':0.00006)'Simulium duolongum':0.00014,('GBMNC2078-20':0.00000,('GBMNC2076-20':0.00000,'GBMNC2077-20':0.00000)'Simulium maelanoiense':0.00000)'Simulium maelanoiense':0.00011)Simulium:0.00007,('GBMIN61138-17':0.00016,(('GBMNA46450-19':0.00022,(('GBMNE30238-21':0.00000,'GBMNE30239-21':0.00000)Simulium:0.00011,('GBMNA46448-19':0.00008,(('GBMNA46392-19':0.00004,('GBMNA46432-19':0.00014,('GBMNA46429-19':0.00002,('GBMNA46433-19':0.00002,'GBMNA46391-19':0.00001)'Simulium asakoae':0.00001)'Simulium asakoae':0.00001)'Simulium asakoae':0.00001)'Simulium asakoae':0.00003,('GBMNA46403-19':0.00000,('GBMNA46398-19':0.00000,'GBMNA46404-19':0.00000)'Simulium asakoae':0.00000)'Simulium asakoae':0.00001)'Simulium asakoae':0.00004)'Simulium asakoae':0.00001)Simulium:0.00004)Simulium:0.00001,('GBMNA46406-19':0.00009,(('GBSIM417-14':0.00000,('GBSIM416-14':0.00009,'GBSIM378-14':0.00000)Simulium:0.00000)Simulium:0.00007,((('THSIM047-09':0.00004,('THSIM026-09':0.00004,(('STHAI248-12':0.00000,'GBMNC2069-20':0.00002)Diptera:0.00002,('GBMNC2070-20':0.00000,'GBMNC2071-20':0.00000)'Simulium muangpanense':0.00000)Diptera:0.00004)Diptera:0.00002)Diptera:0.00007,((('GBMNC2065-20':0.00006,('GBMNC2064-20':0.00002,('GBMNC9349-20':-0.00001,'GBMNC2066-20':0.00003)Simulium:0.00000)Simulium:0.00001)Simulium:0.00008,(('GBMNC2072-20':0.00001,('GBMNC2074-20':0.00000,'GBMNC2073-20':0.00000)'Simulium teerachanense':0.00002)'Simulium teerachanense':0.00022,(('GBDP19127-15':0.00001,'GBDP19128-15':0.00004)'Simulium izuae':0.00013,('GMMGD3239-14':0.00002,'GBDP19157-15':0.00003)'Simulium roslihashimi':0.00009)Simulium:0.00008)Simulium:0.00004)Simulium:0.00006,('GBMNC2068-20':0.00005,('GBMNC9348-20':0.00002,'GBMNC2067-20':0.00000)Simulium:0.00000)Simulium:0.00003)Simulium:0.00005)Diptera:0.00004,(('GBMNE30253-21':0.00002,('GBMNE30261-21':0.00000,('GBMNE30255-21':0.00000,'GBMNE30254-21':0.00000)Simulium:0.00000)Simulium:0.00000)Simulium:0.00000,(('GBMNE30257-21':0.00000,'GBMNE30260-21':0.00000)Simulium:0.00000,(('GBMNE30259-21':0.00000,'GBMNE30258-21':0.00000)Simulium:0.00000,('GBMNE30241-21':0.00000,'GBMNE30240-21':0.00000)Simulium:0.00000)Simulium:0.00000)Simulium:0.00002)Simulium:0.00008)Diptera:0.00002)Diptera:0.00001)Diptera:0.00003)Diptera:0.00004)Diptera:0.00008)Diptera:0.00011)Diptera:0.00012)Diptera:0.00002)Diptera:0.00014)Diptera:0.00002,((OQ117897:0.00000,Query:0.00000):0.00036,(((('BETN11523-21':0.00000,'BETN13304-22':0.00000)'Dicaelus sculptilis sculptilis':0.00000,(('BETN13221-22':0.00000,'BETN13306-22':0.00000)'Dicaelus sculptilis sculptilis':0.00000,('BETN5857-19':0.00000,'BETN8580-20':0.00000)'Dicaelus sculptilis sculptilis':0.00000)'Dicaelus sculptilis sculptilis':0.00000)'Dicaelus sculptilis sculptilis':0.00000,(('ISUP125-14':0.00000,'ISUP128-14':0.00000)'Dicaelus sculptilis intricatus':0.00000,('ISUP130-14':0.00000,'ISUP131-14':0.00000)'Dicaelus sculptilis intricatus':0.00000)'Dicaelus sculptilis intricatus':0.00000)'Dicaelus sculptilis':0.00082,('BDORO064-14':0.00065,(('GBMNA27350-19':0.00060,('GBDP14574-13':0.00000,('GBDP14579-13':0.00000,'GBDP14580-13':0.00000)'Stomoxys indicus':0.00000)'Stomoxys indicus':0.00056)Diptera:0.00004,(('JSDIQ236-10':0.00001,'JSDIP589-10':0.00001)'Brachyopa daeckei':0.00062,('TTMDI548-10':0.00059,(('GMRSA900-14':0.00006,'GMRSA151-14':0.00005)Diptera:0.00041,(('DINOR354-18':0.00001,'ZMBN227-16':0.00002)Dicranota:0.00044,('XJDQD1081-18':0.00019,('FINTI349-12':0.00001,('GDIP020-18':0.00002,((('GDIP023-18':0.00000,'FINTI245-12':0.00000)'Dicranota bimaculata':0.00000,('EUTIP419-11':0.00000,'EUTIP420-11':0.00000)Diptera:0.00000)Diptera:0.00000,(('EUTIP245-11':0.00000,'EUTIP421-11':0.00000)Diptera:0.00000,(('GBMIX439-14':0.00000,'EUTIP247-11':0.00000)Diptera:0.00000,('FINTI103-11':0.00000,'EUTIP248-11':0.00000)Diptera:0.00000)Diptera:0.00000)Diptera:0.00000)Diptera:0.00000)Diptera:0.00002)Diptera:0.00031)Diptera:0.00015)Diptera:0.00014)Diptera:0.00003)Diptera:0.00002)Diptera:0.00004)Diptera:0.00002)Diptera:0.00011)Insecta:0.00007):0.00010);";

$newick = file_get_contents('ar122_r202.tree');


// serious bug, tree seems to have some missing nodes
//$newick = file_get_contents('map2.tre');

$newick = file_get_contents('GTDB/ar122_r202.sp_labels.tree');

$newick = "(((('ABINP4232-21':0.00035,(('ACHAR1446-18':0.00000,('ACHAR1447-18':0.00000,('ACHAR1968-18':-0.00001,'ACHAR2038-18':0.00003)g__Procladius:0.00001)g__Procladius:0.00000)g__Procladius:0.00001,(('ACHAR3221-19':0.00000,('ACHAR3218-19':0.00000,'ACHAR3222-19':0.00000)g__Procladius:0.00000)g__Procladius:0.00006,('ACHAR3223-19':0.00000,'ACHAR1904-18':0.00001)g__Procladius:0.00004)g__Procladius:0.00001)g__Procladius:0.00040)g__Procladius:0.00037,(('ABOLA898-15':0.00068,('ABOLB641-15':0.00053,'ABLCV650-09':0.00058)o__Lepidoptera:0.00012)'s__Eupithecia satyrata':0.00016,(('ACGBA5113-15':0.00000,'ACGBA5121-15':0.00000)'s__Carcelia flavirostrisDHJ32':0.00069,(('ABINP623-21':0.00000,('ABINP5931-21':-0.00001,('ABINP2225-21':0.00000,(('ABINP569-21':0.00000,(('ABINP2321-21':0.00000,'ABINP706-21':0.00000)g__Coenosia:0.00000,(('ABINP1137-21':0.00000,'ABINP2295-21':0.00000)g__Coenosia:0.00000,('ABINP4498-21':0.00000,'ABINP769-21':0.00000)g__Coenosia:0.00000)g__Coenosia:0.00000)g__Coenosia:0.00000)g__Coenosia:0.00000,('ABINP1187-21':0.00000,('ABINP3102-21':0.00000,('ABINP4831-21':0.00000,('ABINP4802-21':0.00000,('ABINP4350-21':0.00000,('ABINP5230-21':0.00000,'ABINP6122-21':0.00001)g__Coenosia:0.00000)g__Coenosia:0.00000)g__Coenosia:0.00000)g__Coenosia:0.00000)g__Coenosia:0.00000)g__Coenosia:0.00000)g__Coenosia:0.00000)g__Coenosia:0.00001)g__Coenosia:0.00001)g__Coenosia:0.00065,('ABMSP922-17':0.00061,(('ABMSP1325-17':0.00005,'ABMSP1117-17':0.00009)'s__Anopheles squamosus':0.00061,('ACMIP132-07':0.00067,('ACMIP208-07':0.00003,('ACMIP223-07':0.00002,((('ACMIP220-07':0.00000,'ACMIP218-07':0.00000)'s__Culex territans':0.00002,('ACMIP217-07':0.00000,'ACMIP224-07':0.00000)'s__Culex territans':0.00001)'s__Culex territans':0.00001,('ACMIP222-07':0.00002,('ACMIP219-07':0.00001,('ACMIP210-07':0.00001,('ACMIP209-07':0.00000,'ACMIP211-07':0.00000)'s__Culex territans':0.00001)'s__Culex territans':0.00001)'s__Culex territans':0.00001)'s__Culex territans':0.00000)'s__Culex territans':0.00000)'s__Culex territans':0.00001)'s__Culex territans':0.00043)g__Culex:0.00006)f__Culicidae:0.00008)f__Culicidae:0.00002)o__Diptera:0.00008)o__Diptera:0.00004)c__Insecta:0.00003)c__Insecta:0.00006,(Query:0.00070,('ABINP3110-21':0.00052,(('ABINP4142-21':0.00080,('ABSSI974-22':0.00000,('ABSSI831-22':0.00000,('ABSSI1017-22':0.00000,('ABSSI1020-22':0.00000,('ABSSI839-22':0.00000,('ABSSI821-22':0.00000,'ABSSI947-22':0.00000)g__Smittia:0.00000)g__Smittia:0.00000)g__Smittia:0.00000)g__Smittia:0.00000)g__Smittia:0.00000)g__Smittia:0.00055)sf__Orthocladiinae:0.00002,(('ABSSI1539-22':0.00000,'ABSSI1394-22':0.00000)f__Chironomidae:0.00002,('ABSSI1548-22':0.00000,('ABSSI1411-22':0.00000,('ABSSI1498-22':0.00000,('ABSSI1532-22':0.00000,(('ABSSI1600-22':0.00000,('ABSSI116-22':0.00000,'ABSSI1584-22':0.00000)f__Chironomidae:0.00000)f__Chironomidae:0.00000,('ABSSI1650-22':0.00000,(('ABSSI1617-22':0.00000,'ABSSI034-22':0.00000)f__Chironomidae:0.00000,((('ABSSI1604-22':0.00000,'ABSSI213-22':0.00000)f__Chironomidae:0.00000,('ABSSI1413-22':0.00000,'ABSSI1590-22':0.00000)f__Chironomidae:0.00000)f__Chironomidae:0.00000,(('ABSSI1010-22':0.00000,'ABSSI1605-22':0.00000)f__Chironomidae:0.00000,('ABSSI1527-22':0.00000,('ABSSI1523-22':0.00000,'ABSSI1403-22':0.00000)f__Chironomidae:0.00000)f__Chironomidae:0.00000)f__Chironomidae:0.00000)f__Chironomidae:0.00000)f__Chironomidae:0.00000)f__Chironomidae:0.00000)f__Chironomidae:0.00000)f__Chironomidae:0.00000)f__Chironomidae:0.00000)f__Chironomidae:0.00000)f__Chironomidae:0.00001)f__Chironomidae:0.00065)sf__Orthocladiinae:0.00015)sf__Orthocladiinae:0.00009)sf__Orthocladiinae:0.00004)c__Insecta,((((('ACHAR2120-18':0.00001,'ACHAR2130-18':0.00002)'s__Cricotopus obnixus':0.00028,('ABSSI1345-22':0.00005,(('ACHAR2099-18':0.00000,('ACHAR1899-18':0.00000,'ACHAR1897-18':0.00000)'s__Cricotopus obnixus':0.00000)'s__Cricotopus obnixus':0.00001,('ACHAR3186-19':0.00000,'ACHAR1288-18':0.00000)'s__Cricotopus obnixus':0.00000)'s__Cricotopus obnixus':0.00003)'s__Cricotopus obnixus':0.00018)'s__Cricotopus obnixus':0.00050,('ACHAR3194-19':0.00072,('ABINP5761-21':0.00001,'ABINP2067-21':0.00002)f__Chironomidae:0.00062)g__Cricotopus:0.00010)'s__Cricotopus obnixus':0.00002,(('ABINP3093-21':0.00044,('ABINP2665-21':0.00072,('ABSSI1064-22':-0.00001,'ABSSI574-22':0.00003)sf__Orthocladiinae:0.00056)g__Orthocladius:0.00007)g__Orthocladius:0.00021,('AACTA3640-20':0.00074,'ABINP5864-21':0.00069)sf__Orthocladiinae:0.00008)sf__Orthocladiinae:0.00002)sf__Orthocladiinae:0.00007,(('ABINP3962-21':0.00002,'ABINP3057-21':0.00003)g__Orthocladius:0.00071,(('ACHAR1463-18':0.00008,'ACHAR1280-18':0.00008)'s__Orthocladius sp. TE13':0.00049,('ACHAR270-18':0.00009,'ACHAR279-18':0.00015)g__Orthocladius:0.00049)'s__Orthocladius sp. TE13':0.00021)'s__Orthocladius sp. TE13':0.00005)sf__Orthocladiinae:0.00001)c__Insecta;";
$newick = "((('ABINP5736-21':0.00063,(('AACTA7101-20':0.00048,('AACTA6033-20':0.00001,('AACTA6997-20':0.00002,('AACTA7601-20':-0.00001,'AACTA6390-20':0.00001)f__Chloropidae:0.00001)f__Chloropidae:0.00001)f__Chloropidae:0.00047)f__Chloropidae:0.00006,('AACTA7371-20':0.00054,('ABGEN1429-20':0.00050,'ABINP4628-21':0.00054)g__Oscinella:0.00004)g__Oscinella:0.00002)g__Oscinella:0.00004)o__Diptera:0.00004,((('ACGBA5944-16':-0.00001,'ACGBA11128-20':0.00007)'s__Archytas Janzen44':0.00048,('ACGBA4931-15':0.00062,((('ACGBA4974-15':0.00000,'ACGBA3143-13':0.00000)'s__Telothyria ricardocalerloi':0.00000,('ACGBA4999-15':0.00000,('ACGBA4997-15':0.00000,'ACGBA3278-13':0.00000)'s__Telothyria ricardocalerloi':0.00000)'s__Telothyria ricardocalerloi':0.00000)'s__Telothyria ricardocalerloi':0.00024,('ACGBA624-12':0.00014,('ACGBA5067-15':0.00000,('ACGBA2042-12':0.00000,('ACGBA4188-13':0.00000,('ACGAZ1557-12':-0.00001,('ACGBA3079-13':0.00002,'ACGBA3069-13':0.00009)'s__Telothyria eldaararyae':0.00007)'s__Telothyria eldaararyae':0.00000)'s__Telothyria eldaararyae':0.00000)'s__Telothyria eldaararyae':0.00000)'s__Telothyria eldaararyae':0.00012)g__Telothyria:0.00004)g__Telothyria:0.00024)f__Tachinidae:0.00005)f__Tachinidae:0.00005,(('ABINP4039-21':0.00057,'ABINP028-21':0.00053)o__Diptera:0.00008,((('ACGBA10943-20':0.00002,(('ACGBA7675-17':0.00000,('ACGBA8598-18':0.00000,'ACGBA8599-18':0.00000)'s__Patelloa xanthuraDHJ03':0.00000)'s__Patelloa xanthuraDHJ03':0.00000,(('ACGBA8600-18':0.00000,'ACGBA8603-18':0.00000)'s__Patelloa xanthuraDHJ03':0.00000,('ACGBA8607-18':0.00000,'ACGBA8666-18':0.00000)'s__Patelloa xanthuraDHJ03':0.00000)'s__Patelloa xanthuraDHJ03':0.00000)'s__Patelloa xanthuraDHJ03':0.00000)'s__Patelloa xanthuraDHJ03':0.00060,('ABINP008-21':0.00000,'ABINP045-21':0.00000)'s__Phebellia strigifrons':0.00040)sf__Exoristinae:0.00009,(((('ABINP4496-21':0.00000,(('ABINP648-21':0.00000,('ABINP322-21':0.00000,'ABINP881-21':0.00000)'s__Pegoplata nigroscutellata':0.00000)'s__Pegoplata nigroscutellata':0.00000,(('ABINP2215-21':0.00000,'ABINP444-21':0.00000)'s__Pegoplata nigroscutellata':0.00000,('ABINP2159-21':0.00000,('ABINP4644-21':0.00000,'ABINP3892-21':0.00000)'s__Pegoplata nigroscutellata':0.00000)'s__Pegoplata nigroscutellata':0.00000)'s__Pegoplata nigroscutellata':0.00000)'s__Pegoplata nigroscutellata':0.00000)'s__Pegoplata nigroscutellata':0.00015,('ABINP2029-21':0.00000,'ABINP3900-21':0.00000)'s__Pegoplata nigroscutellata':0.00009)'s__Pegoplata nigroscutellata':0.00026,(('ABINP1987-21':0.00011,'ABINP775-21':0.00006)g__Pegomya:0.00044,(('ABINP2341-21':0.00001,('ABINP2476-21':0.00000,'ABINP2707-21':0.00000)g__Pegomya:0.00000)g__Pegomya:0.00005,('ABINP2360-21':0.00003,('ABINP2032-21':0.00005,(('ABINP1858-21':0.00001,'ABINP3097-21':0.00002)g__Pegomya:0.00002,(('ABINP410-21':0.00000,'ABINP3053-21':0.00002)g__Pegomya:0.00001,('ABINP5690-21':0.00002,('ABINP2420-21':0.00000,'ABINP2535-21':0.00000)g__Pegomya:0.00001)g__Pegomya:0.00000)g__Pegomya:0.00002)g__Pegomya:0.00001)g__Pegomya:0.00002)g__Pegomya:0.00001)g__Pegomya:0.00032)g__Pegomya:0.00010)sf__Pegomyinae:0.00004,((('ACGAZ127-11':0.00000,('ACGAZ1564-12':0.00000,'ACGAZ861-11':0.00000)'s__Genea Wood02DHJ02':0.00000)'s__Genea Wood02DHJ02':0.00000,(('ACGAZ129-11':0.00000,'ACGAZ836-11':0.00000)'s__Genea Wood02DHJ02':0.00000,('ACGAZ859-11':0.00000,'ACGAZ841-11':0.00000)'s__Genea Wood02DHJ02':0.00000)'s__Genea Wood02DHJ02':0.00000)'s__Genea Wood02DHJ02':0.00046,('ACHAR3670-19':0.00014,(('ACHAR4190-19':0.00000,'ACHAR3466-19':0.00005)g__Zaphne:0.00001,('ACHAR3459-19':0.00005,('ACHAR3467-19':0.00006,('ACHAR1790-18':0.00000,'ACHAR3458-19':0.00000)g__Zaphne:0.00002)g__Zaphne:0.00000)g__Zaphne:0.00001)g__Zaphne:0.00010)g__Zaphne:0.00039)o__Diptera:0.00003)o__Diptera:0.00001)o__Diptera:0.00001)o__Diptera:0.00002)o__Diptera:0.00004)o__Diptera:0.00003,(('AACTA1004-20':0.00074,Query:0.00042)f__Phoridae:0.00006,(('AACTA1829-20':0.00053,('ABINP5649-21':0.00032,(('ABINP3425-21':0.00004,'ABINP3422-21':0.00004)sf__Syrphinae:0.00037,(('ABINP3444-21':0.00002,('ABINP063-21':0.00000,'ABINP3405-21':0.00000)g__Dasysyrphus:0.00001)g__Dasysyrphus:0.00031,('ABINP3423-21':0.00016,'ABINP094-21':0.00021)g__Dasysyrphus:0.00017)g__Dasysyrphus:0.00002)g__Dasysyrphus:0.00008)g__Dasysyrphus:0.00013)sf__Syrphinae:0.00010,(('ABINP3459-21':0.00053,('ACHAR3454-19':0.00005,('ACHAR3452-19':0.00000,('ACHAR3456-19':0.00000,('ACHAR3453-19':-0.00001,'ACHAR3455-19':0.00001)'s__Helophilus lapponicus':0.00000)'s__Helophilus lapponicus':0.00000)'s__Helophilus lapponicus':0.00002)'s__Helophilus lapponicus':0.00055)sf__Eristalinae:0.00010,(('ABINP3490-21':0.00022,('ABINP3493-21':0.00000,('ABINP083-21':0.00002,'ABINP128-21':0.00000)g__Platycheirus:0.00001)g__Platycheirus:0.00013)'s__Platycheirus varipes':0.00044,('ABINP3390-21':0.00005,('ABINP068-21':0.00000,('ABINP073-21':0.00000,('ABINP1845-21':0.00000,'ABINP3401-21':0.00000)sf__Syrphinae:0.00000)sf__Syrphinae:0.00000)sf__Syrphinae:0.00003)sf__Syrphinae:0.00041)'s__Platycheirus varipes':0.00002)f__Syrphidae:0.00004)f__Syrphidae:0.00005)o__Diptera:0.00001)o__Diptera;";
$newick="(((('ABMC174-05':0.00003,('ABMC218-05':0.00000,'ABMC172-05':0.00000)'s__Canis lupus':0.00002)'s__Canis lupus':0.00099,('ABCDC108-07':0.00089,('ABBM294-05':0.00007,('ABBM307-05':0.00000,'ABBM295-05':0.00000)'s__Thainycteris aureocollaris':0.00008)'s__Thainycteris aureocollaris':0.00082)sf__Vespertilioninae:0.00010)c__Mammalia:0.00006,((('ABRSS334-06':0.00031,('ABBID022-09':0.00008,'ABBID040-09':0.00010)'s__Kerivoula papillosa':0.00019)g__Kerivoula:0.00050,(('ABRSS336-06':0.00000,'ABRSS371-06':0.00002)'s__Kerivoula cf. papillosa':0.00067,('ABBM113-05':0.00002,('ABBSI226-10':0.00001,('ABBM180-05':0.00000,('ABBM122-05':-0.00001,'ABRVN363-06':0.00003)g__Kerivoula:0.00000)g__Kerivoula:0.00001)g__Kerivoula:0.00001)g__Kerivoula:0.00049)g__Kerivoula:0.00009)g__Kerivoula:0.00027,(((('ABBM060-05':-0.00001,'ABBM052-05':0.00018)'s__Kerivoula minuta':0.00002,('ABBTH121-07':0.00001,'ABRSS347-06':0.00004)'s__Kerivoula minuta':0.00001)'s__Kerivoula minuta':0.00076,((('ABRLA075-06':0.00001,('ABBM264-05':0.00004,('ABBM329-05':0.00000,'ABBM239-05':0.00000)'s__Kerivoula kachinensis':0.00001)'s__Kerivoula kachinensis':0.00001)'s__Kerivoula kachinensis':0.00079,((('ABCMA366-06':0.00001,'ABCMA449-06':0.00001)'s__Kerivoula cf. hardwickii':0.00005,(('ABCMA603-07':0.00001,('ABCMA419-06':0.00000,'ABCMA448-06':0.00000)'s__Kerivoula cf. hardwickii':0.00001)'s__Kerivoula cf. hardwickii':0.00002,(('ABCMA452-06':0.00000,'ABCMA393-06':0.00000)'s__Kerivoula cf. hardwickii':0.00002,('ABCMA342-06':0.00004,('ABCMA392-06':0.00000,'ABCMA365-06':0.00000)'s__Kerivoula cf. hardwickii':0.00003)'s__Kerivoula cf. hardwickii':0.00001)'s__Kerivoula cf. hardwickii':0.00000)'s__Kerivoula cf. hardwickii':0.00003)'s__Kerivoula cf. hardwickii':0.00044,(('ABBSI163-09':0.00008,'ABRVN349-06':0.00007)'s__Kerivoula hardwickii':0.00024,(('ABBM220-05':0.00001,'ABBM219-05':0.00007)'s__Kerivoula cf. hardwickii':0.00005,('ABRVN488-06':0.00002,(((('ABRVN468-06':0.00000,'ABRVN471-06':0.00000)'s__Kerivoula cf. hardwickii':0.00000,('ABRVN473-06':0.00000,'ABRVN474-06':0.00000)'s__Kerivoula cf. hardwickii':0.00000)'s__Kerivoula cf. hardwickii':0.00000,(('ABRVN475-06':0.00000,'ABRVN542-06':0.00000)'s__Kerivoula cf. hardwickii':0.00000,('ABRVN469-06':0.00000,'ABRVN541-06':0.00000)'s__Kerivoula cf. hardwickii':0.00000)'s__Kerivoula cf. hardwickii':0.00000)'s__Kerivoula cf. hardwickii':0.00002,(('ABRVN472-06':0.00000,('ABRVN476-06':0.00000,'ABRVN477-06':0.00000)'s__Kerivoula cf. hardwickii':0.00000)'s__Kerivoula cf. hardwickii':0.00000,(('ABRVN478-06':0.00000,'ABRVN519-06':0.00000)'s__Kerivoula cf. hardwickii':0.00000,('ABRVN489-06':0.00000,'ABRVN470-06':0.00000)'s__Kerivoula cf. hardwickii':0.00000)'s__Kerivoula cf. hardwickii':0.00000)'s__Kerivoula cf. hardwickii':0.00001)'s__Kerivoula cf. hardwickii':0.00001)'s__Kerivoula cf. hardwickii':0.00002)'s__Kerivoula cf. hardwickii':0.00038)g__Kerivoula:0.00007)g__Kerivoula:0.00009)g__Kerivoula:0.00013,(('ABBID001-08':0.00005,'ABBID064-09':0.00013)'s__Kerivoula krauensis':0.00054,('ABBTH137-07':0.00016,(('ABBM372-05':0.00006,(('ABBM249-05':0.00000,'ABRLA045-06':0.00000)'s__Kerivoula cf. hardwickii':0.00001,('ABRLA051-06':0.00001,'ABBM265-05':0.00002)'s__Kerivoula cf. hardwickii':0.00001)'s__Kerivoula cf. hardwickii':0.00001)'s__Kerivoula cf. hardwickii':0.00012,('ABBM164-05':0.00004,(('ABBM144-05':0.00002,'ABBM207-05':0.00004)'s__Kerivoula cf. hardwickii':0.00008,('ABRLA096-06':0.00004,('ABBM176-05':0.00001,'ABBM109-05':0.00004)'s__Kerivoula cf. hardwickii':0.00001)g__Kerivoula:0.00001)g__Kerivoula:0.00002)g__Kerivoula:0.00012)g__Kerivoula:0.00006)g__Kerivoula:0.00048)g__Kerivoula:0.00012)g__Kerivoula:0.00007)g__Kerivoula:0.00003,('ABBID020-09':0.00052,(('ABRSS370-06':0.00001,(('ABBTH034-07':0.00000,('ABBTH003-07':0.00000,'ABBTH113-07':0.00000)'s__Kerivoula hardwickii':0.00002)'s__Kerivoula hardwickii':0.00001,('ABBTH025-07':0.00001,('ABBTH001-07':0.00002,'ABBM053-05':0.00004)g__Kerivoula:0.00012)g__Kerivoula:0.00001)g__Kerivoula:0.00003)g__Kerivoula:0.00003,((('ABRLA159-06':0.00000,'ABRLA149-06':0.00002)'s__Kerivoula cf. hardwickii':0.00002,(('ABBM055-05':0.00000,Query:0.00000)'s__Kerivoula cf. hardwickii':0.00007,(('ABBSI202-10':0.00000,('ABRVN365-06':0.00000,'ABRVN364-06':0.00000)'s__Kerivoula cf. hardwickii':0.00000)g__Kerivoula:0.00002,('ABRVN350-06':0.00000,'ABRVN340-06':0.00000)'s__Kerivoula cf. hardwickii':0.00002)g__Kerivoula:0.00001)g__Kerivoula:0.00001)g__Kerivoula:0.00002,(('ABBSI320-11':0.00002,'ABBSI324-11':0.00000)'s__Kerivoula hardwickii':0.00000,('ABBSI321-11':0.00000,(('ABBSI322-11':0.00000,'ABBSI325-11':0.00000)'s__Kerivoula hardwickii':0.00000,('ABBSI326-11':0.00000,'ABBSI323-11':0.00000)'s__Kerivoula hardwickii':0.00000)'s__Kerivoula hardwickii':0.00000)'s__Kerivoula hardwickii':0.00000)'s__Kerivoula hardwickii':0.00002)g__Kerivoula:0.00002)g__Kerivoula:0.00041)g__Kerivoula:0.00017)g__Kerivoula:0.00001)g__Kerivoula:0.00002)c__Mammalia,(('ABBWP065-06':0.00089,'ABBM320-05':0.00098)f__Vespertilionidae:0.00010,('ABBID023-09':0.00080,('ABFG389-10':0.00091,(('ABCMA190-06':0.00000,'ABCMA199-06':0.00000)'s__Myotis ikonnikovi':0.00000,('ABCMA198-06':0.00000,'ABCMA197-06':0.00000)'s__Myotis ikonnikovi':0.00000)'s__Myotis ikonnikovi':0.00099)'s__Myotis ikonnikovi':0.00004)f__Vespertilionidae:0.00003)f__Vespertilionidae:0.00002)c__Mammalia;";


$newick = file_get_contents('7371.tree');
$newick = file_get_contents('treeoflife.current.tree');

$t = parse_newick($newick);

echo $t->WriteNewick();

$t->BuildWeights($t->GetRoot());

$o = new RightOrder($t);
$o->Order();

$initial_size = 9;

$zoom = 5;
//$zoom = 4;
//$zoom = 2;
//$zoom = 6;
//$zoom = 1;
//$zoom = 3;

//$zoom = 7;

// how many lines is this drawing allowed?
$k = pow(2, $zoom - 1) * $initial_size;

echo "k=$k\n";

// Clear any "marked" nodes in input the tree
clear_marks($t);

// Clear list of nodes to be included in collapsed tree
$subtree = array();

// Include root of tree in collapsed tree
add_children_to_subtree($subtree, $t->GetRoot(), true);

// Clear the priority queue
$queue = array();

// Add root of tree to the priority queue
add_children_to_queue($queue, $t->GetRoot());

// Grow the collapsed tree until we reach size limit
while(count($queue) > 0 && count($subtree) < $k)
{
	// pop off next node to add
	$c = array_shift($queue);
	
	// note implicit assumption that tree is binary,
	// if we have a polytomy then subtree may grow beyond k 
	// without us realising it (e.g., last node added could add 10 addiitonal nodes)
	add_children_to_subtree($subtree, $c->node);
	
	add_children_to_queue($queue, $c->node);
}


// Create a copy of the original tree containing just the "marked" nodes.
// This is the subtree we will draw.

$copy_of_tree = copy_marked_tree($t);


$order_to_label = array();
$order_to_node = array();


get_inorder($t, $order_to_label, $order_to_node);


// draw
$images = array();

foreach ($copy_of_tree->id_to_node_map as $id => $q)
{
	$original = $q->original;

	if ($q->IsLeaf())
	{
		if ($original->IsLeaf())
		{
			$images[$original->GetAttribute('order')] = $original->GetAttribute('order') . '-leaf.svg';
	
		}
		else
		{
			$images[$original->GetAttribute('order')] = $original->GetAttribute('order'). '-internal_closed.svg';
		}
	}
	else
	{
		$images[$original->GetAttribute('order')] = $original->GetAttribute('order') . '-internal_open.svg';
	}
}

ksort($images, SORT_NUMERIC);

print_r($images);

// dump

$html = '<html>';
$html .= '<div>';

foreach ($images as $image)
{
	$html .= '<div style="display:block;overflow: auto;">';				
	$html .= '<img src="rows/' . $image . '" />';
	$html .= '</div>';

}


$html .= '</div>';

// for debugging show the subtree (which is the order in which nodes were added to tree)
$html .= '<h2>Subtree</h2>';
$html .= '<ul>';

foreach ($subtree as $id)
{
	$html .= '<li>';
	$html .= $id;
	$html .= ' ' . $t->id_to_node_map[$id]->GetLabel();
	
	
	
	$html .= '</li>';	
}


$html .= '</html>';
file_put_contents($zoom . '.html', $html);





?>

